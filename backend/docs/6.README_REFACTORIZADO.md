# Sistema de Agentes Inteligentes para Kodea - Refactorizado

## üéØ Objetivo

Sistema de agentes especializados para procesar postulaciones de fondos para la Fundaci√≥n Kodea, siguiendo los **12 factores de los agentes de IA** y las reglas espec√≠ficas de `contextos.md`.

## üèóÔ∏è Arquitectura Refactorizada

### **Componentes Principales**

#### **1. KodeaContextManager** (Gestor √önico de Contextos)
- **Funci√≥n**: Gesti√≥n centralizada de todos los contextos
- **Caracter√≠sticas**:
  - Selecci√≥n inteligente de contextos usando **solo LLM** (nunca palabras clave)
  - Seguimiento estricto de las reglas de `contextos.md`
  - Identificaci√≥n autom√°tica de iniciativas
  - Construcci√≥n de contexto espec√≠fico por pregunta

#### **2. KodeaCoordinator** (Coordinador Principal)
- **Funci√≥n**: Orquesta todo el flujo de trabajo
- **Responsabilidades**:
  - Identifica iniciativa de la postulaci√≥n
  - Coordina agentes especializados
  - Asegura consistencia entre respuestas
  - Maneja flujo de control estructurado

#### **3. Agentes Especializados**
- **`KodeaAnalyzer`**: Analiza postulaciones pasadas y contexto
- **`KodeaWriter`**: Genera respuestas de alto est√°ndar
- **`KodeaValidator`**: Valida consistencia y calidad

### **Flujo de Trabajo**

```
1. Nueva Postulaci√≥n
   ‚Üì
2. Identificar Iniciativa (KodeaContextManager)
   ‚Üì
3. Cargar Contexto Base de Iniciativa
   ‚Üì
4. Para cada pregunta:
   ‚îú‚îÄ‚îÄ Seleccionar contextos con LLM
   ‚îú‚îÄ‚îÄ Construir contexto espec√≠fico
   ‚îú‚îÄ‚îÄ Generar respuesta
   ‚îî‚îÄ‚îÄ Validar calidad
   ‚Üì
5. Validar Consistencia Global
   ‚Üì
6. Respuesta Final
```

## üöÄ C√≥mo Usar el Sistema

### **1. Configuraci√≥n Inicial**

```bash
# Clonar y navegar al directorio
cd backend

# Copiar archivo de configuraci√≥n
cp env.example .env

# Editar .env con tu API key de Google
# GOOGLE_API_KEY=tu_api_key_aqui
```

### **2. Ejecutar el Sistema**

```bash
# Con Docker (recomendado)
docker-compose up --build

# O sin Docker
pip install -r requirements.txt
python -m app.main
```

### **3. Probar el Sistema**

```bash
# Ejecutar pruebas automatizadas
python test_system.py
```

### **4. Endpoints Disponibles**

#### **Procesar Postulaci√≥n Completa**
```bash
POST /kodea/postulation/process
```

```json
{
  "postulation_id": "test_001",
  "fund_name": "Fondo Basal 2024",
  "fund_description": "Fondo para educaci√≥n tecnol√≥gica",
  "initiative": "Programa de Programaci√≥n Escolar",
  "questions": [
    {
      "question_id": "q1",
      "question_text": "Describa la iniciativa y su impacto esperado"
    }
  ]
}
```

#### **Procesar Pregunta Individual**
```bash
POST /kodea/question/process
```

```json
{
  "question_id": "q1",
  "question_text": "¬øCu√°les son los requisitos t√©cnicos?",
  "fund_context": {
    "fund_name": "Fondo Basal 2024"
  },
  "initiative": "Programa de Programaci√≥n Escolar"
}
```

## üìÅ Estructura de Contextos

### **Archivos de Contexto**
- `memoria/contextos.json`: Definici√≥n de contextos disponibles
- `memoria/fondos_basales.md`: Reglas y requisitos del fondo
- `memoria/formulario_general.md`: Estructura del formulario
- `memoria/kodea_organizacion.md`: Informaci√≥n de la fundaci√≥n
- `memoria/postulaciones_pasadas.md`: Ejemplos hist√≥ricos
- `memoria/educacion_tecnologica.md`: Metodolog√≠as educativas

### **Selecci√≥n Inteligente de Contextos**

El sistema usa **solo LLM** para seleccionar contextos relevantes:

1. **An√°lisis de Pregunta**: El LLM analiza qu√© informaci√≥n necesita
2. **Selecci√≥n de Contextos**: Elige contextos relevantes seg√∫n las reglas
3. **Justificaci√≥n**: Explica por qu√© cada contexto es relevante
4. **Construcci√≥n**: Combina contextos seleccionados en contexto espec√≠fico

## üîß Mejoras Implementadas

### **1. Eliminaci√≥n de Redundancias**
- ‚ùå Eliminado `KodeaContextSelector` (funcionalidad integrada)
- ‚ùå Eliminado `ContextManager` gen√©rico (simplificado)
- ‚úÖ Un solo gestor de contextos centralizado

### **2. Selecci√≥n LLM Pura**
- ‚ùå Eliminada selecci√≥n por palabras clave
- ‚úÖ Solo selecci√≥n inteligente con LLM
- ‚úÖ Seguimiento estricto de `contextos.md`

### **3. Arquitectura Simplificada**
- ‚úÖ Menos componentes, m√°s claridad
- ‚úÖ Responsabilidades bien definidas
- ‚úÖ F√°cil mantenimiento y extensi√≥n

## üß™ Pruebas

### **Ejecutar Pruebas Automatizadas**
```bash
python test_system.py
```

### **Pruebas Incluidas**
1. **Context Manager**: Verifica carga de contextos y selecci√≥n LLM
2. **Coordinator**: Prueba procesamiento completo de postulaci√≥n
3. **Single Question**: Prueba procesamiento de pregunta individual

## üìä Monitoreo

### **Health Check**
```bash
GET /kodea/health
```

### **Informaci√≥n de Agentes**
```bash
GET /kodea/agents/info
```

## üîç Debugging

### **Logs del Sistema**
```bash
# Ver logs en tiempo real
docker-compose logs -f backend
```

### **Variables de Entorno**
```bash
# Verificar configuraci√≥n
echo $GOOGLE_API_KEY
```

## üö® Soluci√≥n de Problemas

### **Error: "No se encontr√≥ el directorio 'memoria'"**
```bash
# Aseg√∫rate de estar en el directorio correcto
cd backend
ls memoria/
```

### **Error: "GOOGLE_API_KEY not set"**
```bash
# Configura tu API key
cp env.example .env
# Editar .env con tu API key
```

### **Error: "Docker compose not found"**
```bash
# Ejecutar desde el directorio backend
cd backend
docker-compose up --build
```

## üìà Pr√≥ximos Pasos

1. **Base de Datos**: Implementar persistencia en PostgreSQL
2. **Vector Store**: Integrar ChromaDB para b√∫squeda sem√°ntica
3. **Cache**: Implementar Redis para optimizaci√≥n
4. **UI**: Desarrollar interfaz web para usuarios
5. **Validaci√≥n**: Mejorar validaci√≥n de consistencia

## ü§ù Contribuci√≥n

El sistema est√° dise√±ado para ser:
- **Modular**: F√°cil agregar nuevos agentes
- **Extensible**: F√°cil agregar nuevos contextos
- **Mantenible**: C√≥digo limpio y documentado
- **Escalable**: Arquitectura preparada para crecimiento 